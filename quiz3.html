<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz 3</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/quiz3.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive_quiz.css') }}">

    <style>
        .btn.selected {
            transform: translateY(-3px) !important;
            background: linear-gradient(50deg, #DF7E7A, #B76A66, #8F5553) !important;
            border: none !important;
            color: #fff !important;
            box-shadow: 0 0 8px 2px rgba(223, 126, 122, 0.4),
                0 0 15px 4px rgba(183, 106, 102, 0.25) !important;
        }
    </style>
</head>

<body data-page="3">
    <header>
        <img src="{{ url_for('static', filename='img/skincare.png') }}" alt="">
        <hr>
    </header>

    <section class="linha"></section>

    <div class="titulo">
        <h2>Você tem alguma preocupação com a área do rosto?</h2>
        <p>Selecione uma opção abaixo para continuar</p>
    </div>

    <div class="perguntas">
        <button class="btn option">
            <h2><img src="{{ url_for('static', filename='img/gota.png') }}" alt="">PELE OLEOSA</h2>
            <p class="texto">Excesso de oleosidade em todo o rosto...</p>
        </button>

        <button class="btn option">
            <h2><img src="{{ url_for('static', filename='img/misto.png') }}" alt="">PELE MISTA</h2>
            <p class="texto">Testa, nariz e queixo oleosos...</p>
        </button>

        <button class="btn option">
            <h2><img src="{{ url_for('static', filename='img/mato.png') }}" alt="">PELE SECA</h2>
            <p class="texto">Ressecamento geral da pele...</p>
        </button>

        <button class="btn option">
            <h2><img src="{{ url_for('static', filename='img/normal.png') }}" alt="">PELE NORMAL</h2>
            <p class="texto">Pele equilibrada, textura suave...</p>
        </button>
    </div>

    <div class="bolinhas">
        <span class="bolinha1"></span>
        <span class="bolinha1"></span>
        <span class="shadow"></span>
        <span class="empty"></span>
        <span class="empty"></span>
        <span class="empty"></span>
        <span class="empty"></span>
    </div>

    <footer class="prx">
        <a id="back" href="{{ url_for('quiz2') }}">←</a>
        <button id="nextBtn" class="btn" style="width:150px; height:40px;">próximo →</button>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const page = parseInt(document.body.dataset.page);
            const optionButtons = [...document.querySelectorAll(".option")];
            const nextBtn = document.getElementById("nextBtn");

            optionButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    optionButtons.forEach(b => b.classList.remove("selected"));
                    btn.classList.add("selected");
                });
            });

            async function enviar() {
                const selected = optionButtons
                    .filter(b => b.classList.contains("selected"))
                    .map(b => b.innerText.trim());

                if (selected.length === 0) {
                    alert("Selecione uma opção para continuar.");
                    return;
                }

                nextBtn.disabled = true;
                nextBtn.textContent = "Enviando...";

                const resp = await fetch("/api/save_answer", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ page, choices: selected })
                });

                const data = await resp.json();
                window.location.href = data.next;

                nextBtn.disabled = false;
            }

            nextBtn.addEventListener("click", enviar);
        });
    </script>
</body>

</html>
